<div
  class="page-wrapper"
  id="main-wrapper"
  data-layout="vertical"
  data-navbarbg="skin6"
  data-sidebartype="full"
  data-sidebar-position="fixed"
  data-header-position="fixed"
>
  {{> sidebar}}
  <div class="body-wrapper">
    {{> adminHeader}}
    <div class="container-fluid">
      <div class="container-fluid">
        <div class="card">
          <div class="card-body">
            <div class="col-lg-8 d-flex align-items-stretch">
              {{! <div class="card w-100"> }}
              <div class="card-body p-4">
                <h5 class="card-title fw-semibold mb-4"><a href="/admin/orders">Orders</a></h5>
                <div class="dropdown float-right pl-2">
                  <button
                    class="btn btn-outline-secondary dropdown-toggle"
                    type="button"
                    data-toggle="dropdown"
                    aria-haspopup="true"
                    aria-expanded="false"
                  >
                    Date<i class="ti ti-adjustments"></i>
                  </button>
                  <div
                    class="dropdown-menu"
                    aria-labelledby="dropdownMenuButton"
                  >
                    <a class="dropdown-item " href="/admin/filter/?l=0&h=20000">
                      Less than ₹20000</a>
                    <a
                      class="dropdown-item "
                      href="/admin/filter/?l=20000&h=30000"
                    > ₹20000 </a>
                    <a
                      class="dropdown-item " 
                      href="/admin/filter/?l=30000&h=100000"
                    > More than ₹30000</a>
                  </div>
                </div>
                <div class="dropdown float-right pl-2">
                  <button
                    class="btn btn-outline-secondary dropdown-toggle"
                    type="button"
                    data-toggle="dropdown"
                    aria-haspopup="true"
                    aria-expanded="false"
                  >
                    Payment<i class="ti ti-adjustments"></i>
                  </button>
                  <div
                    class="dropdown-menu"
                    aria-labelledby="dropdownMenuButton"
                  >
                    <a class="dropdown-item" href="/admin/filter/COD">
                      COD</a>
                    <a
                      class="dropdown-item"
                      href="/admin/filter/razorPay"
                    > Online</a>
                  </div>
                </div>
                <div class="dropdown float-right pl-2">
                  <button
                    class="btn btn-outline-secondary dropdown-toggle"
                    type="button"
                    data-toggle="dropdown"
                    aria-haspopup="true"
                    aria-expanded="false"
                  >
                    Price<i class="ti ti-adjustments"></i>
                  </button>
                  <div
                    class="dropdown-menu"
                    aria-labelledby="dropdownMenuButton"
                  >
                    {{!-- href="/admin/filter/?l=0&h=20000"> --}}
                    <a class="dropdown-item"
                    id="price"
                     href="/admin/filter/?l=0&h=20000"
                      >Less than ₹20000</a>
                    <a
                      class="dropdown-item price"
                      href="/admin/filter/?l=20000&h=30000"
                    > ₹20000 </a>
                    <a
                      class="dropdown-item price"
                      href="/admin/filter/?l=30000&h=100000"
                    > More than ₹30000</a>
                  </div>
                </div>
                {{! <h5 class="card-title fw-semibold mb-4">Recent Transactions</h5> }}
                <div class="table-responsive">
                  <table class="table text-nowrap mb-0 align-middle">
                    <thead class="text-dark fs-4">
                      <tr>
                        <th class="border-bottom-0">
                          <h6 class="fw-semibold mb-0">User</h6>
                        </th>
                        <th class="border-bottom-0">
                          <h6 class="fw-semibold mb-0">Phone</h6>
                        </th>

                        <th class="border-bottom-0">
                          <h6 class="fw-semibold mb-0">Payment Type</h6>
                        </th>
                        <th class="border-bottom-0">
                          <h6 class="fw-semibold mb-0">Amount</h6>
                        </th>
                        <th class="border-bottom-0">
                          <h6 class="fw-semibold mb-0">Status</h6>
                        </th>
                        <th class="border-bottom-0">
                          <h6 class="fw-semibold mb-0">Options</h6>
                        </th>
                      </tr>
                    </thead>
                    {{#each orders}}
                      <tbody>
                        <tr>
                          <td class="border-bottom-0"><h6
                              class="fw-semibold mb-0"
                            >{{this.userid.name}}</h6></td>
                          <td class="border-bottom-0">
                            <h6 class="fw-semibold mb-1">{{this.phone}}</h6>
                          </td>
                          <td class="border-bottom-0">
                            <p
                              class="mb-0 fw-normal"
                            >{{this.payment.paymentType}}</p>
                          </td>
                          <td class="border-bottom-0">
                            <div class="d-flex align-items-center gap-2">
                              <p class="mb-0 fw-normal">₹{{this.totalPrice}}</p>
                            </div>
                          </td>
                          <td class="border-bottom-0">
                            <h6
                              class="fw-semibold mb-0 fs-4 orderStatus"
                              id="orderStatus"
                            >{{this.status}}</h6>
                          </td>

                          <td>
                            <div class="dropdown">
                              <button
                                class="btn btn-outline-secondary dropdown-toggle"
                                type="button"
                                id="dropdownMenuButton"
                                data-toggle="dropdown"
                                aria-haspopup="true"
                                aria-expanded="false"
                              >
                                More
                              </button>
                              <div
                                class="dropdown-menu"
                                aria-labelledby="dropdownMenuButton"
                              >
                                <a
                                  class="dropdown-item status"
                                  href="#"
                                  data-orderid="{{this._id}}"
                                  data-action="shipped"
                                >Shipped</a>
                                <a
                                  class="dropdown-item status"
                                  href="#"
                                  data-orderid="{{this._id}}"
                                  data-action="delivered"
                                >Delivered</a>
                                <a
                                  class="dropdown-item status"
                                  href="#"
                                  data-orderid="{{this._id}}"
                                  data-action="cancelled"
                                >Cancelled</a>
                              </div>
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    {{/each}}
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function () {
      $('.status').click(function (e) {
        e.preventDefault()
        let action = $(this).data('action')
        let orderId = $(this).data('orderid')
        var statusElement = $(this).closest('tr').find('.orderStatus');
        $.ajax({
          type: "PUT",
          url: "/admin/update-order?action=" + action + "&orderId=" + orderId,
          success: function (response) {
            if (response.updatedOrder == null) {
              Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Cannot do this operation!",
              });
            } else {
              statusElement.text(response.updatedOrder.status);

            }
          }
        })
      })
  )}
</script>